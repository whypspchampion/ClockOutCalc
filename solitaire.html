<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classic Solitaire</title>
<style>
    body {
        background: #008000;
        font-family: Arial, sans-serif;
        margin: 0;
        padding: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }
    h1 {
        color: white;
        margin-bottom: 10px;
    }
    .top-row {
        display: flex;
        gap: 10px;
        margin-bottom: 20px;
        align-items: center;
        width: 100%;
        max-width: 1000px;
    }
    .piles-group {
        display: flex;
        gap: 10px;
    }
    .pile {
        width: 100px;
        height: 140px;
        border: 2px solid #d3d3d3;
        background: #006400;
        position: relative;
        border-style: solid;
    }
    .foundation, .tableau {
        border-style: dashed;
    }
    .card {
        width: 90px;
        height: 126px;
        border: 1px solid #000;
        background: white;
        position: absolute;
        text-align: center;
        font-size: 20px;
        cursor: move;
        user-select: none;
        display: flex;
        align-items: flex-start;
        justify-content: flex-start;
        padding: 6px;
        box-sizing: border-box;
    }
    .card.red { color: red; }
    .card.face-down {
        background: #000;
        color: white;
        cursor: default;
    }
    .card.moving { opacity: 0.5; }
    #tableau-row {
        display: flex;
        gap: 10px;
    }
    /* Win7-ish button */
    button {
        padding: 8px 20px;
        font-size: 14px;
        background: linear-gradient(to bottom, #f2f2f2, #d9d9d9);
        border: 1px solid #888;
        border-radius: 3px;
        box-shadow: inset 0 1px 0 #fff, 0 1px 2px rgba(0,0,0,0.2);
        cursor: pointer;
    }
    button:hover {
        background: linear-gradient(to bottom, #ffffff, #cfcfcf);
    }
    button:active {
        background: linear-gradient(to bottom, #cfcfcf, #ffffff);
        box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
    }
    /* Optional: subtle highlight when dragging over a pile */
    .pile.drag-over {
        outline: 3px dashed rgba(255,255,255,0.6);
        outline-offset: -3px;
    }
</style>
</head>
<body>
<h1>Solitaire</h1>

<!-- Top Row: Stock/Waste/Foundations + New Game + Back to Calculator -->
<div class="top-row">
    <div class="piles-group">
        <div id="stock" class="pile" onclick="drawCard()"></div>
        <div id="waste" class="pile"></div>
        <div id="foundation1" class="pile foundation"></div>
        <div id="foundation2" class="pile foundation"></div>
        <div id="foundation3" class="pile foundation"></div>
        <div id="foundation4" class="pile foundation"></div>
    </div>
    <div style="margin-left: auto; display: flex; gap: 5px;">
        <button onclick="newGame()">New Game</button>
        <button onclick="window.location.href='http://www.protoncube.com/'">Back to Calculator</button>
    </div>
</div>

<!-- Tableau Row -->
<div id="tableau-row">
    <div id="tableau1" class="pile tableau"></div>
    <div id="tableau2" class="pile tableau"></div>
    <div id="tableau3" class="pile tableau"></div>
    <div id="tableau4" class="pile tableau"></div>
    <div id="tableau5" class="pile tableau"></div>
    <div id="tableau6" class="pile tableau"></div>
    <div id="tableau7" class="pile tableau"></div>
</div>

<script>
const suits = ['♠', '♣', '♥', '♦'];
const ranks = ['A', '2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K'];
let deck = [];
let stock = [];
let waste = [];
let foundations = [[], [], [], []];
let tableau = [[], [], [], [], [], [], []];

function createDeck() {
    deck = [];
    for (let suit of suits) {
        for (let rank of ranks) {
            deck.push({ suit, rank, color: (suit === '♥' || suit === '♦') ? 'red' : 'black', faceUp: false });
        }
    }
    shuffle(deck);
}

function shuffle(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
}

function dealCards() {
    stock = [];
    waste = [];
    foundations = [[], [], [], []];
    tableau = [[], [], [], [], [], [], []];

    let deckCopy = deck.slice();
    for (let i = 0; i < 7; i++) {
        for (let j = i; j < 7; j++) {
            let card = deckCopy.pop();
            card.faceUp = (i === j);
            tableau[j].push(card);
        }
    }
    stock = deckCopy;
    render();
}

function render() {
    // Stock
    document.getElementById('stock').innerHTML = stock.length ? '<div class="card face-down"></div>' : '';

    // Waste
    const wasteEl = document.getElementById('waste');
    wasteEl.innerHTML = '';
    if (waste.length > 0) {
        wasteEl.appendChild(createCardElement(waste[waste.length - 1], 'waste', waste.length - 1));
    }

    // Foundations
    for (let i = 0; i < 4; i++) {
        let f = document.getElementById(`foundation${i + 1}`);
        f.innerHTML = '';
        if (foundations[i].length > 0) {
            f.appendChild(createCardElement(foundations[i][foundations[i].length - 1], `foundation${i + 1}`, foundations[i].length - 1));
        }
    }

    // Tableau
    for (let i = 0; i < 7; i++) {
        let t = document.getElementById(`tableau${i + 1}`);
        t.innerHTML = '';
        tableau[i].forEach((card, index) => {
            let cardElement = createCardElement(card, `tableau${i + 1}`, index);
            cardElement.style.top = `${index * 20}px`;
            t.appendChild(cardElement);
        });
    }
}

function createCardElement(card, pileId, index) {
    let div = document.createElement('div');
    div.className = 'card' + (card.faceUp ? '' : ' face-down');
    if (card.faceUp) {
        div.textContent = `${card.rank}${card.suit}`;
        div.classList.add(card.color);
        div.draggable = true;
        div.addEventListener('dragstart', e => dragStart(e, pileId, index));
    }
    div.addEventListener('dragover', e => e.preventDefault());
    div.addEventListener('drop', e => drop(e, pileId));
    return div;
}

function attachPileDropTargets() {
    document.querySelectorAll('.pile').forEach(pileEl => {
        pileEl.addEventListener('dragover', e => {
            e.preventDefault();
            pileEl.classList.add('drag-over');
        });
        pileEl.addEventListener('dragleave', () => pileEl.classList.remove('drag-over'));
        pileEl.addEventListener('drop', e => {
            pileEl.classList.remove('drag-over');
            drop(e, pileEl.id);
        });
    });
}

function dragStart(e, pileId, index) {
    e.dataTransfer.setData('text/plain', JSON.stringify({ pileId, index }));
}

function drop(e, targetPileId) {
    e.preventDefault();
    const data = e.dataTransfer.getData('text');
    if (!data) return;
    let { pileId, index } = JSON.parse(data);
    if (pileId === targetPileId) return;

    let sourcePile = getPileArray(pileId);
    let targetPile = getPileArray(targetPileId);
    if (!sourcePile || !targetPile) return;

    let movingCards = sourcePile.slice(index);

    if (targetPileId.startsWith('foundation') && movingCards.length > 1) {
        movingCards = [movingCards[0]];
    }

    if (isValidMove(targetPileId, movingCards[0], targetPile)) {
        sourcePile.splice(index, movingCards.length);
        targetPile.push(...movingCards);

        if (pileId.startsWith('tableau') && sourcePile.length > 0 && !sourcePile[sourcePile.length - 1].faceUp) {
            sourcePile[sourcePile.length - 1].faceUp = true;
        }
        render();
    }
}

function getPileArray(id) {
    if (id === 'waste') return waste;
    if (id.startsWith('foundation')) return foundations[parseInt(id[10]) - 1];
    if (id.startsWith('tableau')) return tableau[parseInt(id[7]) - 1];
    return null;
}

function isValidMove(targetId, movingCard, targetPile) {
    if (!movingCard) return false;

    if (targetId.startsWith('foundation')) {
        if (targetPile.length === 0) return movingCard.rank === 'A';
        return movingCard.suit === targetPile[targetPile.length - 1].suit &&
               ranks.indexOf(movingCard.rank) === ranks.indexOf(targetPile[targetPile.length - 1].rank) + 1;
    } else if (targetId.startsWith('tableau')) {
        if (targetPile.length === 0) return movingCard.rank === 'K';
        let topCard = targetPile[targetPile.length - 1];
        return movingCard.color !== topCard.color &&
               ranks.indexOf(movingCard.rank) === ranks.indexOf(topCard.rank) - 1;
    }
    return false;
}

function drawCard() {
    if (stock.length > 0) {
        let card = stock.pop();
        card.faceUp = true;
        waste.push(card);
    } else {
        stock = waste.reverse().map(c => ({ ...c, faceUp: false }));
        waste = [];
    }
    render();
}

function newGame() {
    createDeck();
    dealCards();
}

newGame();
attachPileDropTargets();
</script>
</body>
</html>
